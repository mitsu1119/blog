---
date: "2023-06-01T16:46:29+09:00"
title: "超楕円曲線暗号を理解するぞ"
tags: ["elliptic curve", "math"]
draft: true
math: true
---

## はじめに
　超楕円曲線を，こと超楕円曲線暗号のシステムを理解することに絞って最短ルートで解説できたらなと思います．とは言っても，記事の内容に大きな間違いがあるかもしれません．疑問に思ったことや間違っていそうなことがありましたらぜひ twitter なりなんなりで教えてください．僕が悩みます．
$\gdef\C{\mathbb{C}} \gdef\R{\mathbb{R}}$

## 定義とか

　今まで扱ってきた楕円曲線は $v^2 + h(u)v = f(u)$ で $\deg f = 3$ みたいなものでした．これに種数 $g$ という概念を追加します．  
　曲線の右辺の多項式 $f$ の次数に関して，種数 $g$ を $\deg f = 2g + 1$ となる整数と定義します．  
　通常の楕円曲線は種数 $1$ の曲線で，またその自然な拡張として $g = 2$ のものや $g = 3$ のものも考えることができるようになります．これらの種数が $1$ よりも大きい代数曲線を**超楕円曲線**といいます．

**定義**  
　体 $K$ を係数とする次数 $2g + 1$ のモニック多項式を $f \in K[u]$ とする．このとき（$K$ 上で定義される）超楕円曲線 $C$ は，次数 $g$ 以下の多項式 $h \in K[u]$ を用いて
$$C: v^2 + h(u)v = f(u)$$
を満たす ${\bar K}^2$ 上の点全体と無限遠点の集合として定義される（正確には射影多様体で考えるべきですがここでは省略します）．

　普通超楕円曲線という場合は非特異なものに限りますが，慣用的に特異点を持つ超楕円曲線という言い方をする場合もあります（楕円曲線でもそういうノリはありますよね……気のせい？）．

　ちなみに種数の概念が急に出てきて曲線の次数を $2$ ずつ増やしていくのに違和感があるかもしれません．この種数というものは位相幾何の言葉だと「閉曲面の切断によって生じる多様体が連結なままである最大回数」みたいな感じで定義されています．  
　楕円曲線は $\wp$ 関数のパラメータから生成される格子 $\Lambda$ を使うと $E(\C) \simeq \C / \Lambda$ でした．また $\C/\Lambda$ は幾何学的にはトーラスだったので種数の定義と合致しており，天下り的に見える種数の登場は代数曲線を複素多様体の世界から見たときに自然な導入となるのです．

![例のあれ](post14/reinoare.png)

## 特異点の条件
　曲線ができるだけ非特異な場合を考えたいですが，じゃあ非特異な曲線はどういう曲線なのか気になります．ということで $F = v^2 + h(u)v - f$ としておいて，この関数について調べていきたいと思います．

　まず特異点 $P = (x, y)$ では $F(P) = 0$ が成り立ちます．また各変数での偏微分を考えてあげると
$$\frac{\partial F}{\partial u} = \frac{d h}{du} v - \frac{df}{du}$$
$$\frac{\partial F}{\partial v} = 2v + h$$
となり，どちらも特異点でゼロになります．よって特異な曲線とは，ある点 $P = (x, y) \in {\bar K}^2$ で
$$
\begin{cases}
y^2 + h(x)y = f(x) \\\\ 
h'(x)y = f'(x) \\\\ 
2y+h(x)=0 \\\\ 
\end{cases}$$
となる曲線だということがわかります．

![Singular なネコ](post14/singular_cat.png "Singular なネコ")　← Singular なネコ（力作）

## 標準形
　うわああああああ $h(u)$ 邪魔すぎて面倒くさい〜〜〜〜．超楕円曲線にも Weierstrass 標準形はないんですか？

　$C: v^2 + h(u)v = f(u)$ について $u \rightarrow u,\ v \rightarrow v - h(u) / 2$ と変数変換してあげると
$$\begin{aligned} (v - h(u) / 2)^2 + h(u)(v - h(u) / 2) &= f(u) \\\\ 
v^2 - h(u)v + h(u)^2 / 4 + h(u)v - h(u)^2/2 &= f(u) \\\\ 
v^2 &= f(u) + h(u)^2 / 2
\end{aligned}$$
となります．また右辺は $deg h \geq g$ だったので種数も変わりません．  
　ということでこんな感じで標準形が与えられます．

**命題**  
　$K$ 上の超楕円曲線 $C$ について，$\mathrm{char}(K) \neq 2$ であるとき $C$ と双有理同値な $v^2 = f(u)$ 型の種数が同じ超楕円曲線が存在する．

例として $\R$ 上の曲線 $y^2 + (x^2 - 2x - 3)y = 3x^5 - x^4 + x^3 + x^2 - x - 3$ の標準形を求めてみると $y^2 = 3x^5 - x^4 / 2 - x^3  + 5x  + 3/2$ となります．

![標準形のグラフ](post14/hyoujun.png)　← 緑が元の曲線，赤が標準形

## 曲線上の点

**定義**  
　$K$ 上で定義される曲線 $C$ の**K-有理点**を以下の式で定義する．
$$C(K) = (C \cap K^2) \cup \left\\{ P_{\infty} \right\\}$$
特に $C = C({\bar K}^2)$．

　多分この辺は楕円曲線と変わらないと思います．$\tilde{P}$ が曲線上にあることは，次のように代入すれば簡単に確かめられます．

$$\begin{aligned}
(-y-h(x))^2 + h(x)(-y - h(x)) &= y^2+2h(x)y + h^2(x) - h(x)y - h^2(x)\\\\ 
&= y^2 + h(x)y\\\\ 
&= f(x)
\end{aligned}$$

**定義**  
　finite point $P = (x, y)$ について，その反数を $\tilde{P} = (x, -y -h(x))$ とする．無限遠点に関しては $\tilde{P_\infty} = P_\infty$ とする．  
　また $\tilde{P} = P$ となる点を**分岐点**と呼び，そうでない点を **ordinary point** と呼ぶ．

## 関数

　多様体上の関数について考えてあげると良いことが起きることが一般的によく知られています．ということで超楕円曲線 $C$ 上の関数を考えてみましょう．

　例えば $K$ 上の曲線 $C: F = 0$ 上の関数でぱっと思い浮かぶのは $f \in K[u,v]$ です．ですが $K$ 代数において $C$ は別に代数的じゃないので $f$ の根に $C$ に含まれない点が出てきてしまい，$C$ にぴったりフィットする関数全体として $K[u,v]$ はちょっと大きすぎる気がします．  
　そこで，じゃあ根が同じくらい $C$ から離れている関数同士は同一視しようという発想が出てきます．数学では結構ありがちですね．ということで Let's イデアル．

　次のような $F$ から生成されるイデアルを考えます．
$$I(C) = \left\\{ f \in K[u, v] \mid \forall P \in C , f(P) = 0 \right\\}$$
　このイデアルで剰余をとってあげた環 $K[u,v] / I(C)$ がちょうど $C$ の関数としてふさわしくなります．$f, g$ が $C$ 上で同じ値をとれば $f \equiv g \mod I(C)$ となっていい感じですね．  
　このような $C$ 上の代数的な関数全体としてぴったり機能しそうな集合 $K[u, v]/I(C)$ を**座標環**といいます．
　また $I(C) = (F)$ なので，座標環は $K[u,v]/(F)$ とも書けますね．

**定義**  
　$K$ 上の超楕円曲線 $C: v^2 + h(u)v = f(u)$ の**座標環** $K[C]$ とは次のような剰余環である．
$$K[C] = K[u,v]/(v^2 + h(u)v - f(u))$$
　$\bar K$ 上についても同様に $\bar K[C] = \bar K[u,v]/(v^2 + h(u)v - f(u))$ とし，この元を**多項式**という．

　超楕円曲線上の関数 $g \in \bar K [C]$ は，$g$ の $v^2$ を $h(u)v - f(u)$ に置き換えていけば $v$ に関して次数 $1$ になります．つまり $a, b \in \bar K[u]$ を用いて $g = a(u) - b(u)v$ と書くことができます．
　$u$ に関して次数 $2g + 1$ 以下，$v$ に関して次数 $1$ 以下で表現できますね．

## 有理関数
　多項式が作れたので有理関数も作りたくなるとことです．有理関数があれば極と零点が定義できますが，実はこれが超楕円曲線を利用した群の構成に密接に関わってくるのです．  
　定義は簡単かつ自然なのでペッてします．

**定義**  
　$K$ 上の超楕円曲線 $C$ の**関数体** $K(C)$ を以下で定義する．
$$K(C) = \mathrm{Frac}(K[C])$$
$\bar K$ についても同様に $\bar K(C) = \mathrm{Frac}(\bar K[C])$ とし，この元を**有理関数**という．

　また，これから使うことになるので極と零点を定義しておきます．解析っぽい話になってウムウムって感じなので雑にノリで定義します．まあ複素解析とほぼ変わらんのですが．

**定義**  
　$f \in K(C)$ とする．$P \in C$ が $f(P) = 0$ を満たす時，$P$ は $f$ の**零点**であるという．
また，$1 / f(P) = 0$ であるとき $P$ は $f$ の**極**であるという．

　極や零点の位数も定義できます．まあ重複度ですね．$P \in C$ の零点としての位数を $m_Z(P)$，極としての位数を $m_S(P)$ と書きます．
　有名な命題として以下のようなものがあります．

**命題**  
　$f \in K(C)$ について，$f$ の零点全体の集合を $Z_f$，極全体の集合を $S_f$ としたとき以下が成り立つ．
$$\sum_{P \in Z_f} m_Z(P) = \sum_{P \in S_f} m_S(P)$$

　要するに重複度を込めて零点と極の数は同じということですね．

